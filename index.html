<!DOCTYPE html>
<html>
<head>
	<title>InfoScreen - Server Stats</title>
    <!--[if lt IE 9]><script language="javascript" type="text/javascript" src="js/excanvas.js"></script><![endif]-->
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript" src="js/jquery.jqplot.min.js"></script>
    <script type="text/javascript" src="js/plugins/jqplot.pieRenderer.min.js"></script>
    <link rel="stylesheet" type="text/css" href="js/jquery.jqplot.css" />
    <style type="text/css">
    body {
        font-family: "Arial";
        background-color: #123456;
    }
    .label {
        color:#eaa228; font-size:18px;
    }
    .value {
        color:#4bb2c5; font-size:18px;
    }
    .header {
        color:#4bb2c5; font-size:26px; font-weight:bold;
    }
    </style>

    <script type="text/javascript">
    // Get all data as json every 5 minutes
    function get_all_json_data() {
        $.getJSON('./php/get_data.php?q=all', function(data) {
            // Give each html element a value
            $.each(data, function(key, value){
                $('#'+key).html(value);
            });
            create_cpu_graph(data.cpu_load_perc_free, data.cpu_load_perc_used);
            create_ram_graph(Number(data.ram_free.match(/\d+\.?\d*/)), Number(data.ram_used.match(/\d+\.?\d*/)));
            create_root_graph(Number(data.fs_root_free.match(/\d+\.?\d*/)), Number(data.fs_root_used.match(/\d+\.?\d*/)));
            create_swap_graph(Number(data.fs_swap_free.match(/\d+\.?\d*/)), Number(data.fs_swap_used.match(/\d+\.?\d*/)));
            setTimeout(get_all_json_data, 60 * 5 * 1000);
        });
    }
    
    // Get cpu data as json every 10 sec
    function get_cpu_json_data() {
        $.getJSON('./php/get_data.php?q=cpu', function(data) {
            create_cpu_graph(data.cpu_load_perc_free, data.cpu_load_perc_used);
            setTimeout(get_cpu_json_data, 10 * 1000);
        });
    }

    // Get network data (dl and ul speed) as json every 10 sec
    function get_network_json_data() {
        $.getJSON('./php/get_data.php?q=network', function(data) {
            $('#dl_speed').html(data.dl_speed);
            $('#ul_speed').html(data.ul_speed);
            setTimeout(get_network_json_data, 10 * 1000);
        });
    }

    function create_cpu_graph(free, used) {
        var cpu_data = [[['Free', free], ['Used', used]]];
        var plot3 = $.jqplot('cpu', cpu_data, {
            grid: {
                drawBorder: false,
                drawGridlines: false,
                shadow:false
            },
            seriesDefaults:{
                shadow: false,
                renderer:$.jqplot.PieRenderer,
                rendererOptions:{
                    showDataLabels: true,
                    sliceMargin: 4,
                    startAngle: -90
                }
            },
            legend:{ 
                show: false, 
                location: 's'
            }
        });
    }

    function create_root_graph(free, used) {
        var root_data = [[['Free', free], ['Used', used]]];
        var plot3 = $.jqplot('fs', root_data, {
            grid: {
                drawBorder: false,
                drawGridlines: false,
                shadow:false
            },
            seriesDefaults:{
                shadow: false,
                renderer:$.jqplot.PieRenderer,
                rendererOptions:{
                    showDataLabels: true,
                    sliceMargin: 4,
                    startAngle: -90
                }
            },
            legend:{ 
                show: false, 
                location: 's'
            }
        });
    }
    
    function create_swap_graph(free, used ) {
        var swap_data = [[['Free', free],['Used', used]]];
        var plot3 = $.jqplot('swap', swap_data, {
            grid: {
                drawBorder: false,
                drawGridlines: false,
                shadow:false
            },
            seriesDefaults:{
                shadow: false,
                renderer:$.jqplot.PieRenderer,
                rendererOptions:{
                    showDataLabels: true,
                    sliceMargin: 4,
                    startAngle: -90
                }
            },
            legend:{ 
                show: false, 
                location: 's'
            }
        });
    }
    
    function create_ram_graph(free, used) {
        var ram_data = [[['Free', free],['Used', used]]];
        var plot3 = $.jqplot('ram', ram_data, {
            grid: {
                drawBorder: false,
                drawGridlines: false,
                shadow:false
            },
            seriesDefaults:{
                shadow: false,
                renderer:$.jqplot.PieRenderer,
                rendererOptions:{
                    showDataLabels: true,
                    sliceMargin: 4,
                    startAngle: -90
                }
            },
            legend:{ 
                show: false, 
                location: 's'
            }
        });
    }
        
    $(document).ready(function() {
        get_all_json_data();
        get_network_json_data();
        get_cpu_json_data();
    });
    </script>
</head>
<body>
    <div id="cont">
    
        <div id="without_graph" style="overflow:hidden;">
            <div style="float:left;">
                <span class="header">General</span>
                <div style="height:0px;"></div>
                <div style="margin-right:10%;">
                  <div><span class="label">Kernel:</span> <span id="kernel" class="value"></span></div>
                  <div><span class="label">Distro:</span> <span id="distro" class="value"></span></div>
                  <div><span class="label">Uptime:</span> <span id="uptime" class="value"></span></div>
                  <div><span class="label">Processes:</span> <span id="processes" class="value"></span></div>
                </div>
            </div>
            
            <div style="float:left;">
                <span class="header">Network</span>
                <div style="height:0px;float:left;"></div>
                <div style="margin-right:0%;">
                    <div><span class="label">Device:</span> <span id="network_device" class="value"></span></div>
                    <div><span class="label">IPv4 address:</span> <span id="ipv4_addr" class="value"></span></div>
                    <div><span class="label">Download speed:</span> <span id="dl_speed" class="value"></span></div>
                    <div><span class="label">Upload speed:</span> <span id="ul_speed" class="value"></span></div>
                </div>
            </div>
        </div>
        
        <div id="with_graph" style="margin-top:3%;">
            <div style="float:left;">
                <span class="header">Processor</span>
                <div id="cpu" style="height:200px;width:200px;text-align:center;"></div>
                <div style="margin-right:10%;">
                    <div><span class="label">Model:</span> <span id="cpu_model" class="value"></span></div>
                    <div><span class="label">Frequency:</span> <span id="cpu_freq" class="value"></span></div>
                    <div><span class="label">Cores:</span> <span id="cpu_cores" class="value"></span></div>
                    <div><span class="label">Temp:</span> <span id="cpu_temp" class="value"></span></div>
                </div>
            </div>
            
            <div style="float:left;">
                <span class="header">Memory</span>
                <div id="ram" style="height:200px;width:200px;text-align:center;"></div>
                <div style="margin-right:10%;">
                  <div><span class="label">Total:</span> <span id="ram_total" class="value"></span></div>
                  <div><span class="label">Used:</span> <span id="ram_used" class="value"></span></div>
                  <div><span class="label">Free:</span> <span id="ram_free" class="value"></span></div>
                </div>
            </div>
            
            <div style="float:left;">
                <span class="header">Root</span>
                <div id="fs" style="height:200px;width:200px;text-align:center;"></div>
                <div style="margin-right:10%;">
                  <div><span class="label">Total:</span> <span id="fs_root_total" class="value"></span></div>
                  <div><span class="label">Used:</span> <span id="fs_root_used" class="value"></span></div>
                  <div><span class="label">Free:</span> <span id="fs_root_free" class="value"></span></div>
                  <div><span class="label">Type:</span> <span id="fs_root_type" class="value"></span></div>
                </div>
            </div>
          
            <div style="float:left;">
                <span class="header">Swap</span>
                <div id="swap" style="height:200px;width:200px;text-align:center;"></div>
                <div style="margin-right:10%;">
                    <div><span class="label">Total:</span> <span id="fs_swap_total" class="value"></span></div>
                    <div><span class="label">Used:</span> <span id="fs_swap_used" class="value"></span></div>
                    <div><span class="label">Free:</span> <span id="fs_swap_free" class="value"></span></div>
                    <div><span class="label">Swappiness:</span> <span id="fs_swap_swappiness" class="value"></span></div>
                </div>
            </div>
         
         </div>

    </div>
</body>
</html>